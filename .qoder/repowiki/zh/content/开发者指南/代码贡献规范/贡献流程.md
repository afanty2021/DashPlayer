# 贡献流程

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [package.json](file://package.json)
- [src/backend/services/impl/AbstractOssServiceImpl.ts](file://src/backend/services/impl/AbstractOssServiceImpl.ts)
- [src/common/utils/Util.ts](file://src/common/utils/Util.ts)
- [src/backend/utils/TypeGuards.ts](file://src/backend/utils/TypeGuards.ts)
- [src/backend/controllers/StorageController.ts](file://src/backend/controllers/StorageController.ts)
- [src/backend/controllers/WatchHistoryController.ts](file://src/backend/controllers/WatchHistoryController.ts)
- [src/common/types/aiRes/AiFuncPolish.ts](file://src/common/types/aiRes/AiFuncPolish.ts)
- [src/common/types/msg/AiCtxMenuPolishMessage.ts](file://src/common/types/msg/AiCtxMenuPolishMessage.ts)
- [src/backend/errors/AssertionError.ts](file://src/backend/errors/AssertionError.ts)
</cite>

## 目录
1. [简介](#简介)
2. [Fork 仓库](#fork-仓库)
3. [创建特性分支](#创建特性分支)
4. [编写 Commit 信息](#编写-commit-信息)
5. [Pull Request 提交要求](#pull-request-提交要求)
6. [运行测试套件](#运行测试套件)
7. [与维护者沟通](#与维护者沟通)
8. [代码审查与合并](#代码审查与合并)
9. [最佳实践建议](#最佳实践建议)

## 简介
DashPlayer 是一个专为英语学习设计的开源视频播放器，支持双语字幕、AI 字幕生成、蓝牙遥控等功能。该项目采用 Electron + React + TypeScript 技术栈构建，代码结构清晰，模块化程度高。本文档详细说明向 DashPlayer 项目贡献代码的标准流程，确保贡献过程规范、高效且符合项目质量要求。

**Section sources**
- [README.md](file://README.md#L1-L241)

## Fork 仓库
贡献代码的第一步是 Fork 官方仓库。访问 [DashPlayer GitHub 仓库](https://github.com/solidSpoon/DashPlayer)，点击右上角的 "Fork" 按钮，将项目复制到您的个人 GitHub 账户下。Fork 后，克隆您自己的仓库到本地开发环境：

```bash
git clone https://github.com/your-username/DashPlayer.git
cd DashPlayer
```

随后添加上游仓库作为远程源，以便同步主分支的最新更改：

```bash
git remote add upstream https://github.com/solidSpoon/DashPlayer.git
```

定期执行 `git fetch upstream` 可以获取主仓库的最新更新，保持本地开发环境与主分支同步。

**Section sources**
- [README.md](file://README.md#L1-L241)

## 创建特性分支
在本地仓库中，基于 `main` 分支创建新的特性分支。分支命名必须遵循清晰、一致的规范，采用 `feature/`、`fix/` 或 `docs/` 前缀，后接简明的描述性名称，使用连字符分隔单词。例如：

```bash
git checkout -b feature/ai-transcription-enhancement
```

或修复 bug：

```bash
git checkout -b fix/subtitle-timing-issue
```

良好的分支命名有助于维护者快速理解分支目的，提高代码审查效率。避免使用模糊或无意义的名称（如 `patch-1`、`update`）。

**Section sources**
- [README.md](file://README.md#L1-L241)

## 编写 Commit 信息
每次提交代码时，必须编写符合约定格式的 Commit 信息。标准格式为：

```
<类型>(<作用域>): <简要描述>

<详细描述>

<关联的 Issue>
```

- **类型（Type）**：`feat`（新功能）、`fix`（修复 bug）、`docs`（文档更新）、`style`（代码格式调整）、`refactor`（重构）、`test`（测试相关）、`chore`（构建或辅助工具变更）
- **作用域（Scope）**：可选，指明修改的模块，如 `ai`、`player`、`storage`、`ui`
- **简要描述**：一句话概括变更内容，使用现在时态
- **详细描述**：可选，解释变更原因、实现方式和影响
- **关联的 Issue**：如 `Closes #123`

示例：
```
feat(ai): 添加 AI 字幕润色功能

实现右键菜单调用 OpenAI 对选中句子进行三种方式润色。
使用 zod 定义响应结构，确保数据类型安全。

Closes #45
```

**Section sources**
- [src/common/types/aiRes/AiFuncPolish.ts](file://src/common/types/aiRes/AiFuncPolish.ts#L1-L20)
- [src/common/types/msg/AiCtxMenuPolishMessage.ts](file://src/common/types/msg/AiCtxMenuPolishMessage.ts#L1-L50)

## Pull Request 提交要求
创建 Pull Request (PR) 时，必须包含以下关键信息：

1. **功能说明**：清晰描述 PR 实现的功能或修复的问题。
2. **测试验证结果**：说明如何测试该功能，包括手动测试步骤和自动化测试结果。
3. **相关截图或录屏**：对于 UI 变更，必须提供截图或录屏，直观展示修改效果。
4. **关联 Issue**：在描述中引用相关的 Issue（如 `Closes #123`），便于追踪。

PR 标题应简洁明了，遵循 `[类型] 描述` 的格式，例如 `[feat] 添加 AI 字幕润色功能`。描述部分应详尽，让审查者无需查看代码即可理解变更意图。

**Section sources**
- [README.md](file://README.md#L1-L241)

## 运行测试套件
在提交 PR 前，必须在本地运行完整的测试套件，确保新代码不会破坏现有功能。DashPlayer 使用 Vitest 作为测试框架。运行测试的命令如下：

```bash
yarn test
```

或者，根据 `package.json` 中的脚本定义：

```bash
npm run test
```

确保所有测试用例通过，特别是与您修改代码相关的单元测试和集成测试。如果引入了新功能，应同时添加相应的测试用例，保证代码覆盖率。

**Section sources**
- [package.json](file://package.json#L10-L148)
- [src/backend/test/sentence.test.ts](file://src/backend/test/sentence.test.ts#L1-L15)

## 与维护者沟通
创建 PR 后，积极与项目维护者进行沟通。及时回复审查意见，对提出的疑问进行详细解释。如果审查者建议修改，应尽快在分支上进行调整并推送新提交。保持沟通礼貌、专业，理解维护者需要从项目整体质量和稳定性角度考虑。

对于复杂的功能变更，建议在开始编码前先通过 Issue 与维护者讨论设计方案，避免完成后因设计不符被拒绝。

## 代码审查与合并
维护者会对 PR 进行代码审查，重点关注：
- 代码质量与可读性
- 是否符合项目架构和编码规范
- 功能实现的正确性和健壮性
- 是否包含必要的测试
- 文档是否同步更新

根据审查反馈进行迭代修改，直到满足合并要求。当 PR 获得批准且 CI/CD 流水线通过后，维护者将把您的代码合并到主分支。恭喜您，您已成为 DashPlayer 项目的贡献者！

## 最佳实践建议
- **小步提交**：将大型功能拆分为多个小的、独立的 PR，便于审查和管理。
- **保持分支更新**：定期将 `upstream/main` 的更改合并到您的特性分支，减少最终合并时的冲突。
- **关注文档**：不仅更新代码，也要同步更新相关文档（如 `Writerside` 目录下的 Markdown 文件）。
- **尊重项目风格**：遵循项目现有的代码风格、命名约定和架构模式。

遵循以上流程，您将能够高效、专业地为 DashPlayer 项目做出贡献。

**Section sources**
- [README.md](file://README.md#L1-L241)
- [Writerside/topics/Introduction.md](file://Writerside/topics/Introduction.md#L1-L40)
- [Writerside/topics/Usage.md](file://Writerside/topics/Usage.md#L1-L32)