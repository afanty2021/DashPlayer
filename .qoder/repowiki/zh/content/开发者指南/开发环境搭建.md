# 开发环境搭建

<cite>
**本文档中引用的文件**  
- [package.json](file://package.json)
- [tsconfig.json](file://tsconfig.json)
- [vite.base.config.ts](file://vite.base.config.ts)
- [vite.main.config.ts](file://vite.main.config.ts)
- [vite.renderer.config.ts](file://vite.renderer.config.ts)
- [vite.preload.config.ts](file://vite.preload.config.ts)
- [forge.config.ts](file://forge.config.ts)
- [main.ts](file://src/main.ts)
- [app.tsx](file://src/app.tsx)
- [renderer.ts](file://src/renderer.ts)
</cite>

## 目录
1. [简介](#简介)
2. [基础环境准备](#基础环境准备)
3. [项目克隆与依赖安装](#项目克隆与依赖安装)
4. [TypeScript 配置详解](#typescript-配置详解)
5. [常见问题与解决方案](#常见问题与解决方案)
6. [环境验证步骤](#环境验证步骤)
7. [总结](#总结)

## 简介

本指南旨在为首次参与 DashPlayer 项目开发的贡献者提供完整的开发环境搭建流程。DashPlayer 是一款基于 Electron 和 Vite 构建的桌面应用，使用 TypeScript 作为主要开发语言。本文将详细介绍从环境准备到项目运行的全过程，确保开发者能够快速上手并顺利进行开发工作。

**Section sources**
- [package.json](file://package.json)
- [forge.config.ts](file://forge.config.ts)

## 基础环境准备

### Node.js 版本要求

DashPlayer 项目建议使用 Node.js 18 或更高版本。您可以通过以下命令检查当前 Node.js 版本：

```bash
node --version
```

如果版本低于 18，请前往 [Node.js 官网](https://nodejs.org/) 下载并安装最新 LTS 版本。

### 包管理器：pnpm 安装

虽然项目使用 `yarn` 作为默认包管理器（从 `package.json` 的脚本中可见），但推荐使用 `pnpm` 以获得更好的性能和磁盘空间利用率。安装 pnpm 的命令如下：

```bash
npm install -g pnpm
```

安装完成后，您可以使用 `pnpm` 替代 `yarn` 来管理项目依赖。

**Section sources**
- [package.json](file://package.json)

## 项目克隆与依赖安装

### 克隆仓库

使用 Git 克隆 DashPlayer 项目仓库：

```bash
git clone https://github.com/solidSpoon/DashPlayer.git
cd DashPlayer
```

### 安装依赖

项目使用 `yarn` 进行依赖管理。在项目根目录执行以下命令安装所有依赖：

```bash
yarn install
```

或者，如果您已安装 `pnpm`，也可以使用：

```bash
pnpm install
```

安装过程中，`package.json` 中定义的开发依赖（如 Electron、Vite、TypeScript 等）将被自动下载和配置。

**Section sources**
- [package.json](file://package.json)

## TypeScript 配置详解

### tsconfig.json 结构

项目根目录下的 `tsconfig.json` 文件定义了 TypeScript 编译器的配置选项。以下是关键配置项的解释：

```json
{
    "compilerOptions": {
        "strict": true,
        "experimentalDecorators": true,
        "emitDecoratorMetadata": true,
        "types": ["reflect-metadata"],
        "target": "ESNext",
        "module": "commonjs",
        "allowJs": true,
        "skipLibCheck": true,
        "esModuleInterop": true,
        "noImplicitAny": true,
        "sourceMap": true,
        "baseUrl": ".",
        "outDir": "dist",
        "moduleResolution": "node",
        "resolveJsonModule": true,
        "jsx": "react-jsx",
        "paths": {
            "@/*": [
                "./src/*"
            ]
        }
    }
}
```

### 关键编译选项说明

- **strict**: 启用所有严格类型检查选项
- **experimentalDecorators**: 启用实验性装饰器语法，用于 InversifyJS 依赖注入
- **emitDecoratorMetadata**: 为装饰器发出设计类型元数据
- **target**: 编译目标为最新 ECMAScript 版本
- **module**: 使用 CommonJS 模块系统（适用于 Node.js 环境）
- **allowJs**: 允许编译 JavaScript 文件
- **esModuleInterop**: 启用对 CommonJS 模块的默认导入支持
- **baseUrl** 和 **paths**: 配置模块解析路径，实现 `@/` 别名导入（如 `@/backend/dispatcher`）

这些配置确保了项目能够正确编译 TypeScript 代码，并支持现代 JavaScript 特性和模块化开发。

**Section sources**
- [tsconfig.json](file://tsconfig.json)

## 常见问题与解决方案

### 依赖冲突问题

由于项目依赖较多，可能会出现版本冲突。建议使用 `yarn` 的 `resolutions` 字段或 `pnpm` 的 `overrides` 来锁定特定依赖版本。如果遇到问题，可以尝试清除缓存后重新安装：

```bash
yarn cache clean
yarn install
```

### 构建失败

构建失败可能由多种原因引起：
- 确保 Node.js 版本符合要求
- 检查 `vite` 相关配置文件是否完整
- 确认所有必需的开发依赖已正确安装

### 权限错误

在某些操作系统上，可能需要管理员权限才能执行某些操作。如果遇到权限错误，请尝试：
- 在 Windows 上以管理员身份运行命令提示符
- 在 macOS/Linux 上使用 `sudo` 命令（谨慎使用）

### Electron 相关问题

由于项目基于 Electron，可能会遇到与原生模块相关的问题。确保已安装必要的构建工具：
- Windows: 安装 Visual Studio Build Tools
- macOS: 安装 Xcode 命令行工具
- Linux: 安装必要的编译器和库

**Section sources**
- [package.json](file://package.json)
- [forge.config.ts](file://forge.config.ts)

## 环境验证步骤

### 运行开发模式

完成环境搭建后，通过以下命令启动开发服务器：

```bash
yarn start
```

该命令会执行 `yarn run download` 脚本下载必要资源，然后启动 Electron 应用。

### 验证应用正常启动

成功启动后，应能看到 DashPlayer 主窗口。您还可以通过以下方式验证环境是否正确配置：
- 检查控制台是否有错误信息
- 确认 TypeScript 文件能够被正确编译
- 验证 Vite 开发服务器是否正常运行

### 其他验证命令

```bash
# 运行代码检查
yarn lint

# 运行测试
yarn test

# 打包应用
yarn package
```

这些命令可以帮助您进一步验证开发环境的完整性。

**Section sources**
- [package.json](file://package.json)
- [forge.config.ts](file://forge.config.ts)
- [vite.base.config.ts](file://vite.base.config.ts)
- [vite.main.config.ts](file://vite.main.config.ts)
- [vite.renderer.config.ts](file://vite.renderer.config.ts)
- [vite.preload.config.ts](file://vite.preload.config.ts)

## 总结

通过以上步骤，您应该已经成功搭建了 DashPlayer 项目的开发环境。关键要点包括：
- 使用 Node.js 18+ 版本
- 正确安装和配置包管理器
- 理解 TypeScript 编译配置
- 掌握常见问题的解决方法
- 能够验证环境是否正常工作

现在您可以开始进行功能开发、bug 修复或文档改进了。如有其他问题，请参考项目 Wiki 或联系项目维护者。

**Section sources**
- [README.md](file://README.md)